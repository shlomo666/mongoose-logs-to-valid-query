<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<head>
  <style>
    .menuButton {
      border-radius: 10px;
      background-color: #e7def5;
      width: 100%;
      transition-duration: 0.2s;
      padding: 3px;
      border-width: 0;
      margin-bottom: 2px;
      color: rgb(117, 114, 114);
      font-weight: bold;
    }
    .menuButton:hover {
      color: white;
      background-color: gray;
    }
    code:focus {
     outline: none;
    }
    pre {
      white-space: nowrap;
    }
  </style>
  <style id="redSelection">
    textarea::selection {
      color: white;
      background: red;
    }
  </style>
</head>
<body style="background-color: black; color: #d4d4d4;">
  <div
    id="suggestionsMenu"
    hidden="hidden"
    style="
      z-index: 1000;
      border-radius: 20px;
      position: absolute;
      color: black;
      box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 10px;
      min-width: 200px;
      text-align: center;
      width: fit-content;
      padding: 5px 5px;
    "
  ></div>

  <div
    style="
      padding: 10px;
      font-family: Arial, Helvetica, sans-serif;
      height: 70px;
    "
  >
    <label for="maxCollapse">Max chars for collapse: </label>
    <input
      type="number"
      name="maxCollapse"
      id="maxCollapse"
      value="40"
      step="10"
      style="width: 40px; text-align: center;"
    /><br />
    <input type="checkbox" name="shouldIds" id="shouldIds" />
    <label id="shouldIdsLabel" for="shouldIds"
      >Replace string ids with ObjectId</label
    ><br />
    <input type="checkbox" name="shouldDates" id="shouldDates" />
    <label id="shouldDatesLabel" for="shouldDates"
      >Replace string dates with Date</label
    ><br />
  </div>

  <!-- 100vh - height of above - its padding from both sides - padding from bottom of I/O block -->
  <div style="display: flex; height: calc(100vh - 70px - 20px - 10px);">
    <textarea
      name="input"
      id="inputCode"
      style="
        font-size: 15px;
        font-family: monaco;
        height: 100%;
        width: 29%;
        resize: horizontal;
        overflow: auto;
        margin-right: 1%;
        background-color: #1e1e1e;
        color: #d4d4d4;
      "
      placeholder="Paste Mongoose query from DAL logs here"
      oninput="action()"
      spellcheck="false"
    ></textarea>
    <section><pre
      style="
        border: solid 1px #767676;
        background-color: #1e1e1e;
        color: #d4d4d4;
        font: 15px monaco;
        height: 100%;
        width: 70%;
        overflow: scroll;
        margin: 0;
      "
    >
    <code
      style="padding: 1px 0px; overflow-wrap: unset; -webkit-line-break: unset;"
      contentEditable
      name="output"
      id="outputCode"
    ></code></section>
  </pre>
  </div>
</body>

<script>
  setTimeout(() => {
    const outputCode = document.getElementById('outputCode');
    // outputCode.innerText = String(`db.pagefollowers.aggregate([
    outputCode.innerHTML = spanStrings(`db.pagefollowers.aggregate([
    { $match: { pageId: ObjectId("5a13f48216c53300124e2e2c") } },
    {
      $lookup: {
        from: "users",
        let: { followerId: "userId" },
        pipeline: [
          {
            $match: {
              $and: [
                { $expr: { $eq: [ "$_id", "$$followerId" ] } },
                {
                  $or: [ { "profile.first": /asaf/i }, { 'profile.last': /asaf/i }, { email: /asaf/i } ]
                }
              ]
            }
          },
          { $project: { _id: 1 } }
        ],
        as: "users"
      }
    },
    { $match: { users: { $gt: [] } } },
    { $match: { userId: { $nin: [ ObjectId("5bcc3d58cc368e001187da5c") ] } } },
    { $sort: { createdAt: -1 } },
    { $project: { _id: "$userId" } },
    { $facet: { data: [ { $skip: 0 }, { $limit: 15 } ], totalCount: [ { $count: "count" } ] } },
    { $addFields: { tc: { $arrayElemAt: [ "$totalCount", 0 ] } } },
    { $project: { data: "$data", totalCount: "$tc.count" } }
  ], { allowDiskUse: true });`);
  }, 100);
</script>

<script src="loadQuery.js"></script>
<script src="resizeManager.js"></script>
<script src="loadFromStorage.js"></script>
<script src="index.js"></script>
<script src="selectionActions.js"></script>
<script src="utils.js"></script>
<script src="eval.js"></script>
<script src="moveCode.js"></script>
<!-- <script src="highlightOnOverCode.js"></script> -->
<script src="colorize.js"></script>
